<% layout('layout') %><h1>Thực đơn – <%= branch? branch.name : '' %></h1><form class="inline" action="/menu" method="get"><label>Chi nhánh</label><select name="branch_id" onchange="this.form.submit()"><% branches.forEach(b=>{ %><option value="<%= b.id %>" <%= branch && b.id===branch.id ? 'selected':'' %>><%= b.name %></option><% }) %></select><input type="hidden" name="_csrf" value="<%= csrfToken %>"></form><div style="margin:.5rem 0 1rem 0;"><% categories.forEach(c=>{ %><a href="#cat-<%= c.id %>" class="pill"><%= c.name %></a><% }) %></div><% function money(n){ return (n||0).toLocaleString() + ' đ'; } %><% categories.forEach(c=>{ %><section id="cat-<%= c.id %>"><h2><%= c.name %></h2><% const subs = subcategories.filter(s=>s.category_id===c.id); %><% if (subs.length) { %><% subs.forEach(su=>{ %><h3 style="margin-top:.6rem"><%= su.name %></h3><div class="grid"><% items.filter(i=>i.category_id===c.id && i.subcategory_id===su.id).forEach(i=>{ %><div class="card"><img src="<%= i.image_url || '/public/images/placeholder.jpg' %>" alt="<%= i.name %>"><div class="p"><h3><%= i.name %></h3><p><%= i.description || '' %></p><div class="row"><b><%= money(i.sale_price) %></b><button class="btn" onclick="addToCart(<%= i.id %>)">Thêm</button></div></div></div><% }) %></div><% }) %><% } %><div class="grid"><% items.filter(i=>i.category_id===c.id && !i.subcategory_id).forEach(i=>{ %><div class="card"><img src="<%= i.image_url || '/public/images/placeholder.jpg' %>" alt="<%= i.name %>"><div class="p"><h3><%= i.name %></h3><p><%= i.description || '' %></p><div class="row"><b><%= money(i.sale_price) %></b><button class="btn" onclick="addToCart(<%= i.id %>)">Thêm</button></div></div></div><% }) %></div></section><% }) %><style>.pill{display:inline-block;margin:.15rem .25rem;padding:.35rem .6rem;border:1px solid #eee;border-radius:999px;text-decoration:none;color:#111}.pill:hover{background:#fafafa}</style>